SQL> CREATE TABLE helpdesk_user.tickets (
  2      ticket_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  3      title VARCHAR2(255) NOT NULL,
  4      description CLOB,
  5      status VARCHAR2(50) DEFAULT 'Open' NOT NULL CHECK (status IN ('Open', 'Assigned', 'In Progress', 'Resolved', 'Closed')),
  6      priority VARCHAR2(20) DEFAULT 'Medium' NOT NULL CHECK (priority IN ('Low', 'Medium', 'High', 'Critical')),
  7      created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
  8      updated_date TIMESTAMP,
  9      escalated_to VARCHAR2(100),
 10      resolved_date TIMESTAMP,
 11      assigned_to VARCHAR2(100)
 12  );


SQL> CREATE TABLE helpdesk_user.users (
  2      user_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  3      username VARCHAR2(100) UNIQUE NOT NULL,
  4      full_name VARCHAR2(200),
  5      email VARCHAR2(150) UNIQUE NOT NULL,
  6      role VARCHAR2(50) DEFAULT 'User' NOT NULL CHECK (role IN ('User', 'Technician', 'Manager', 'Admin')),
  7      created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
  8      active CHAR(1) DEFAULT 'Y' CHECK (active IN ('Y', 'N'))
  9  );


SQL> CREATE TABLE helpdesk_user.ticket_history (
  2      history_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  3      ticket_id NUMBER NOT NULL,
  4      action VARCHAR2(100) NOT NULL,
  5      action_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
  6      action_by VARCHAR2(100) NOT NULL,
  7      comments VARCHAR2(4000),
  8      CONSTRAINT fk_ticket FOREIGN KEY (ticket_id) REFERENCES helpdesk_user.tickets(ticket_id)
  9  );


